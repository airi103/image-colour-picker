const fileInput=document.getElementById("fileInput"),imageSection=document.getElementById("imageSection"),canvas=document.getElementById("imageCanvas"),ctx=canvas.getContext("2d"),selectedColor=document.getElementById("selectedColor"),rgbValue=document.getElementById("rgbValue"),hexValue=document.getElementById("hexValue"),colorPreview=document.getElementById("colorPreview"),colorHistory=document.getElementById("colorHistory");let currentImage=null,scale=1;function handleFileSelect(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{currentImage=new Image,currentImage.onload=()=>{imageSection.classList.remove("hidden"),resizeCanvas(),drawImage()},currentImage.src=e.target.result},e.readAsDataURL(t)}}function resizeCanvas(){const e=canvas.parentElement.clientWidth;scale=e/currentImage.width,canvas.width=currentImage.width,canvas.height=currentImage.height,canvas.style.width="100%",canvas.style.height="auto"}function drawImage(){ctx.drawImage(currentImage,0,0,canvas.width,canvas.height)}function getMousePos(e){const t=canvas.getBoundingClientRect(),n=canvas.width/t.width,o=canvas.height/t.height;return{x:(e.clientX-t.left)*n,y:(e.clientY-t.top)*o}}function handleMouseMove(e){const t=getMousePos(e),n=ctx.getImageData(t.x,t.y,1,1).data;updateColorDisplay(n),updateColorPreview(e,n)}function handleClick(e){const t=getMousePos(e);addToHistory(ctx.getImageData(t.x,t.y,1,1).data)}function updateColorDisplay(e){const[t,n,o]=e,a=`rgb(${t}, ${n}, ${o})`,r=rgbToHex(t,n,o);selectedColor.style.backgroundColor=a,rgbValue.textContent=a,hexValue.textContent=r}function updateColorPreview(e,t){const n=canvas.getBoundingClientRect(),[o,a,r]=t;colorPreview.style.left=e.clientX-n.left-12+"px",colorPreview.style.top=e.clientY-n.top-12+"px",colorPreview.style.backgroundColor=`rgb(${o}, ${a}, ${r})`,colorPreview.classList.remove("hidden")}function rgbToHex(e,t,n){return"#"+[e,t,n].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("").toUpperCase()}function addToHistory(e){const[t,n,o]=e,a=`rgb(${t}, ${n}, ${o})`,r=rgbToHex(t,n,o),c=document.createElement("div");c.className="w-8 h-8 rounded-lg cursor-pointer border border-gray-200 transition-transform hover:scale-110",c.style.backgroundColor=a,c.title=r,c.addEventListener("click",(()=>{selectedColor.style.backgroundColor=a,rgbValue.textContent=a,hexValue.textContent=r})),colorHistory.children.length>=10&&colorHistory.removeChild(colorHistory.firstChild),colorHistory.appendChild(c)}function copyToClipboard(e){const t=document.getElementById(e),n=t.textContent;navigator.clipboard.writeText(n).then((()=>{t.classList.add("bg-green-100"),setTimeout((()=>{t.classList.remove("bg-green-100")}),500)}))}fileInput.addEventListener("change",handleFileSelect),canvas.addEventListener("mousemove",handleMouseMove),canvas.addEventListener("click",handleClick),canvas.addEventListener("mouseleave",(()=>{colorPreview.classList.add("hidden")})),window.addEventListener("resize",(()=>{currentImage&&(resizeCanvas(),drawImage())})),document.addEventListener("dragover",(e=>{e.preventDefault(),e.stopPropagation()})),document.addEventListener("drop",(e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer.files[0];t&&t.type.startsWith("image/")&&(fileInput.files=e.dataTransfer.files,fileInput.dispatchEvent(new Event("change")))}));